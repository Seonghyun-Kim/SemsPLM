<?xml version="1.0" encoding="utf-8" ?>
<sqlMap
 namespace="ChangeRequest"
	xmlns="http://ibatis.apache.org/mapping"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <alias>
    <typeAlias alias="ECR"  type="ChangeRequest.Models.ECR" />
  </alias>

  <statements>
    <insert id="InsChangeRequest" parameterClass="ECR">
      INSERT INTO T_DCHANGE_REQUEST
      (
      OID
      ,ItemGroup
      ,Title 
      ,DesignChangeDt 
      ,ReasonChangeRequest
      ,Compatible 
      ,IsMold 
      ,ReasonRegistration 
      ,Security 
      ,Changes
      ,Stock
      ,Memo
      ,IsAttached
      ,SelRequestDt
      ,SelPartNo 
      ,EBom
      ,DevMP 
      ,CarType 
      )
      VALUES
      (
      #OID#
      ,#ItemGroup#
      ,#Title#
      ,#DesignChangeDt# 
      ,#ReasonChangeRequest#
      ,#Compatible#
      ,#IsMold#
      ,#ReasonRegistration#
      ,#Security#
      ,#Changes#
      ,#Stock#
      ,#Memo#
      ,#IsAttached#
      ,#SelRequestDt#
      ,#SelPartNo#
      ,#EBom#
      ,#DevMP# 
      ,#CarType#
      )
    </insert>

    <select id="SelChangeRequest" parameterClass="ECR" resultClass="ECR">
      SELECT
      A.*
      , B.*
      FROM T_DOBJECT A
      LEFT OUTER JOIN T_DCHANGE_REQUEST B ON A.OID = B.OID
      <dynamic prepend="where">
        <isNotNull prepend="and" property="Type">
          A.Type = #Type#
        </isNotNull>
        <isNotNull prepend="and" property="OID">
          A.OID = #OID#
        </isNotNull>
        <isNotNull prepend="and" property="Name">
          A.Name like '%' + #Name# + '%'
        </isNotNull>
        <isNotNull prepend="and" property="StartDesignChangeDt">
          B.DesignChangeDt &gt;= #StartDesignChangeDt#
        </isNotNull>
        <isNotNull prepend="and" property="EndDesignChangeDt">
          B.DesignChangeDt &lt;= #EndDesignChangeDt#
        </isNotNull>
      </dynamic>
      AND A.DeleteDt IS NULL
      ORDER BY A.OID
    </select>

    <update id="UdtChangeRequest" parameterClass="ECR">
      UPDATE T_DCHANGE_REQUEST
    <dynamic prepend="SET">
      <isNotNull prepend="," property="ItemGroup">
        ItemGroup              =  #ItemGroup#
      </isNotNull>
      <isNotNull prepend="," property="Title">
        Title                =  #Title#
      </isNotNull>
      <isNotNull prepend="," property="DesignChangeDt">
        DesignChangeDt       =  #DesignChangeDt#
      </isNotNull>
      <isNotNull prepend="," property="ReasonChangeRequest">
        ReasonChangeRequest  =  #ReasonChangeRequest#
      </isNotNull>
      <isNotNull prepend="," property="Compatible">
        Compatible           =  #Compatible#
      </isNotNull>
      <isNotNull prepend="," property="IsMold">
        IsMold               =  #IsMold#
      </isNotNull>
      <isNotNull prepend="," property="ReasonRegistration">
        ReasonRegistration   =  #ReasonRegistration#
      </isNotNull>
      <isNotNull prepend="," property="Security">
        Security             =  #Security#
      </isNotNull>
      <isNotNull prepend="," property="Changes">
        Changes              =  #Changes#
      </isNotNull>
      <isNotNull prepend="," property="Stock">
        Stock                =  #Stock#
      </isNotNull>
      <isNotNull prepend="," property="Memo">
        Memo                 =  #Memo#
      </isNotNull>
      <isNotNull prepend="," property="IsAttached">
        IsAttached           =  #IsAttached#
      </isNotNull>
      <isNotNull prepend="," property="SelRequestDt">
        SelRequestDt         =  #SelRequestDt#
      </isNotNull>
      <isNotNull prepend="," property="SelPartNo">
        SelPartNo            =  #SelPartNo#
      </isNotNull>
      <isNotNull prepend="," property="EBom">
        EBom                 =  #EBom#
      </isNotNull>
      <isNotNull prepend="," property="DevMP">
        DevMP                =  #DevMP#
      </isNotNull>
      <isNotNull prepend="," property="CarType">
        CarType              =  #CarType#
      </isNotNull>
      WHERE OID = #OID#
    </dynamic>
      
    </update>
  </statements>
</sqlMap>