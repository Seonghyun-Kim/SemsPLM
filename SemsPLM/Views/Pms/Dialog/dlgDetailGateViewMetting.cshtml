
@{
    Layout = null;
}


<div id="gateViewMeeting_@ViewBag.ProcessOID" style="position:relative;">
    <div style="width:100%;display:flex;flex-direction:row;overflow-y:hidden;">
        <div class="dlgMeeting">
            <div class="searchBox">
                <div class="searchTitle" style="line-height: 34px; font-size: 17px; height: 33px;">
                    <label style="font-weight:400;">GATE</label>
                </div>
            </div>
            <div class="dlggateview_@ViewBag.ProjectOID">
                <ul class="gateColumn">
                    <li class="gateTop">
                        <span>프로젝트</span>
                        <h2>GATE</h2>
                    </li>
                    <li>구분</li>
                    <li>이름</li>
                    <li>진행 &amp; 상태</li>
                    <li>예상 시작일</li>
                    <li>예상 완료일</li>
                    <li>실제 시작일</li>
                    <li>실제 완료일</li>
                </ul>
            </div>

        </div>
        <div style="height:600px;flex:2.3;">
            <div class="searchBox">
                <div class="searchTitle" style="line-height: 34px; font-size: 17px; height: 33px; ">
                    <label style="font-weight:400;">목록</label>
                </div>
            </div>
            <div id="dlggateViewMeetingList_@ViewBag.ProcessOID"></div>
        </div>
        <div style="height:600px;flex:2.3;">
            <div class="searchBox">
                <div class="searchTitle" style="line-height: 34px; font-size: 17px; height: 33px; ">
                    <label style="font-weight:400;">상세</label>
                </div>
            </div>
            <div id="dlggateViewMeetingAddEdit_@ViewBag.ProcessOID" style="overflow:auto;height:544px;"></div>
        </div>
    </div>
</div>

<script type="text/javascript">
    var mettingSource = {
        datatype: "json",
        datafields: [
            { name: 'OID' },
            { name: 'ToOID' },
            { name: 'ObjDescription' },
            { name: 'CreateDt', type: "date" },
            { name: 'CreateUs' },
            { name: 'CreateUsNm' },
        ],
        id: 'OID',
        localdata: null
    };
    var grdMetting$ = $("#dlggateViewMeetingList_@ViewBag.ProcessOID");
    var gateBox = document.querySelector(".dlggateview_@ViewBag.ProjectOID");
    var projOid = @ViewBag.ProjectOID;

    $(function () {
        var gateArr = @Html.Raw(Json.Encode(ViewBag.lGateViewDetail));
        for (var index = 0; index < gateArr.length; index++) {
            addGateDetail(gateArr[index]);
        }

        grdMetting$.jqxGrid({
            width: 739,
            height: 542,
            rowsheight: 28,
            columnsheight: 40,
            sortable: false,
            pageable: false,
            columnsresize: true,
            source: mettingSource,
            showtoolbar: false,
            rendertoolbar: function (statusbar) {
            },
            columns: [
                {
                    text: 'NO', width: "10%", cellsalign: 'center', columntype: 'number', align: 'center',
                    cellsrenderer: function (row, column, value) {
                        return "<div style='width:100%;height:100%;text-align:center;vertical-align:middle;line-height:1.9;'>" + (value + 1) + "</div>";
                    }
                },
                { text: '작성일', datafield: 'CreateDt', width: "25%", align: 'center', cellsalign: 'center', cellsformat: 'yyyy-MM-dd HH:mm:ss' },
                { text: '작성자', datafield: 'CreateUsNm', width: "20%", align: 'center', cellsalign: 'center', },
                {
                    text: '회의내용', datafield: 'ObjDescription', width: "45%", align: 'center', cellsalign: 'center',
                    cellsrenderer: function (row, column, value) {
                        if (value != null && value.length > 10) {
                            return "<div style='width:100%;height:100%;text-align:left;vertical-align:middle;line-height:1.9;'>  " + value.substring(0, 10) + "....</div>"
                        } else {
                            return "<div style='width:100%;height:100%;text-align:left;vertical-align:middle;line-height:1.9;'>  " + value + "</div>";
                        }
                    }
                },

            ]
        });


        var dlggateViewMeetingAddEdit$ = $('#dlggateViewMeetingAddEdit_@ViewBag.ProcessOID');

        grdMetting$.on('celldoubleclick', function (event) {
            const args = event.args;
            const key = args.key;
            const row = args.row;
            dlggateViewMeetingAddEdit$.empty();
            dlggateViewMeetingAddEdit$.load('/Pms/DetailGateViewMettingContent',
                { ProjectOID: @ViewBag.ProjectOID, ProcessOID: @ViewBag.ProcessOID, MettingOID: row.bounddata.ToOID }, null);
        });

        dlggateViewMeetingAddEdit$.load('/Pms/DetailGateViewMettingContent',
            { ProjectOID: @ViewBag.ProjectOID, ProcessOID: @ViewBag.ProcessOID }, null);

        getPmsGateViewMettingList(mettingSource, grdMetting$);

    });

    function getPmsGateViewMettingList(_source, _grid$) {
        const param = {};
        param.RootOID = @ViewBag.ProjectOID;
        param.FromOID = @ViewBag.ProcessOID;
        param.Type = "@Common.Constant.PmsConstant.RELATIONSHIP_GATEVIEW_METTING";

        PrintGridView = function (res) {
            PrintJqxGrid(_source, _grid$, res);
        }
        RequestData("/Pms/SelPmsGateMettingList", param, PrintGridView);
    }

    function addGateDetail(params) {
        var project = document.createElement("div");
        var gateImg = document.createElement("div");
        var gateType = document.createElement("span");
        var gateName = document.createElement("h3");
        var gateStatus = document.createElement("div");
        var gateESdate = document.createElement("p");
        var gateEFdate = document.createElement("p");
        var gateASdate = document.createElement("p");
        var gateAFdate = document.createElement("p");

        project.className = "gatebox";
        gateStatus.className = "gatestatus";

        gateImg.innerHTML = "<img src='/Images/gate.png' alt='gate' style='border:0px;padding:12px 40px;'>";
        gateStatus.innerHTML = "<span>" + params.BPolicy.StatusNm + "</span><div class='level' style='width:" + params.Complete + "%;'></div>";
        gateName.innerHTML = "<span>" + params.Type + "</span>" + (params.Name.length > 9 ? params.Name.substring(0, 9) + '..' : params.Name);
        gateESdate.innerHTML = params.EstStartDt != null ? moment(params.EstStartDt).format('YYYY-MM-DD') : '<br/>';
        gateEFdate.innerHTML = params.EstEndDt != null ? moment(params.EstEndDt).format('YYYY-MM-DD') : '<br/>';
        gateASdate.innerHTML = params.ActStartDt != null ? moment(params.ActStartDt).format('YYYY-MM-DD') : '<br/>';
        gateAFdate.innerHTML = params.ActEndDt != null ? moment(params.ActEndDt).format('YYYY-MM-DD') : '<br/>';

        gateBox.appendChild(project);
        project.appendChild(gateImg);
        project.appendChild(gateType);
        project.appendChild(gateName);
        project.appendChild(gateStatus);
        project.appendChild(gateESdate);
        project.appendChild(gateEFdate);
        project.appendChild(gateASdate);
        project.appendChild(gateAFdate);

        $(document).ready(function () {
            $(".gatebox").addClass("gates");
            $(".gatebox > h3").addClass("gateName");
            $(".gatestatus").addClass("status");
            $(".gatebox > p").addClass("gateDates");
            $(".gatestatus > span").addClass("progress");
        });
    }
</script>