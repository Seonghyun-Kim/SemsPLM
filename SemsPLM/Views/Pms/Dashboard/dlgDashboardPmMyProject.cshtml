@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title></title>
</head>
<body>
    <div>
        <h4 class="cleanTitle"><i class="fas fa-file-invoice"></i> 내 프로젝트</h4>
        <div id="pmMyProjectGrid"></div>
    </div>
    <script type="text/javascript">
        var selDashBoardDialog;
        $(function () {

            var projSource = {
                dataType: "json",
                dataFields: [
                    //System Mandatory
                    { name: 'OID', type: 'number' },
                    { name: 'Name', type: 'string' },
                    { name: 'ProjectType', type: 'string' },
                    { name: 'Oem_Lib_Nm', type: 'string' },
                    { name: 'Car_Lib_Nm', type: 'string' },
                    { name: 'ITEM_NoNm', type: 'string' },
                    { name: 'BPolicy', },

                    { name: 'EstDuration', type: 'number' },
                    { name: 'EstStartDt', type: 'date' },
                    { name: 'EstEndDt', type: 'date' },
                    { name: 'ActDuration', type: 'number' },
                    { name: 'ActStartDt', type: 'date' },
                    { name: 'ActEndDt', type: 'date' },
                    { name: 'EstDisposalDt', type: 'date' },

                    //Object Optional
                    { name: 'Description', type: 'string' },
                ],
                id: 'OID',
            }

            $('#pmMyProjectGrid').jqxGrid({
                width: '100%',
                height: 550,
                editable: false,
                columnsresize: true,
                columns: [
                    {
                        text: 'NO', width: "5%", cellsalign: 'center', columntype: 'number', align: 'center',
                        cellsrenderer: function (row, column, value) {
                            return "<div style='width:100%;height:100%;text-align:center;vertical-align:middle;line-height:1.9;'>" + (value + 1) + "</div>";
                        }
                    },
                    { text: '프로젝트명', datafield: 'Name', width: "25%", align: 'center', cellsalign: 'center', },
                    { text: 'OEM', datafield: 'Oem_Lib_Nm', width: "10%", align: 'center', cellsalign: 'center', },
                    { text: '차종', datafield: 'Car_Lib_Nm', width: "10%", align: 'center', cellsalign: 'center', },
                    { text: '고객사', width: "10%", align: 'center', cellsalign: 'center', },
                    {
                        text: '상태', datafield: 'BPolicy', width: "10%", align: 'center', cellsalign: 'center',
                        cellsrenderer: function (row, column, value) {
                            return "<div style='width:100%;height:100%;text-align:center;vertical-align:middle;line-height:1.9;'>" + value.StatusNm + "</div>";
                        },
                    },
                    { text: '기준일', datafield: 'EstStartDt', width: "10%", align: 'center', cellsalign: 'center', cellsFormat: 'yyyy-MM-dd', },
                    { text: '예상종료일', datafield: 'EstEndDt', width: "10%", align: 'center', cellsalign: 'center', cellsFormat: 'yyyy-MM-dd', },
                    { text: '실제종료일', datafield: 'ActEndDt', width: "10%", align: 'center', cellsalign: 'center', cellsFormat: 'yyyy-MM-dd', },
                    { text: '폐기예정일', datafield: 'EstDisposalDt', width: "10%", align: 'center', cellsalign: 'center', cellsFormat: 'yyyy-MM-dd', },
                ],
            });

             RequestData("/Pms/@ViewBag.linker", {}, function (res) {
                 PrintJqxGrid(projSource, $('#pmMyProjectGrid'), res);
             });

            $('#pmMyProjectGrid').on('celldoubleclick', function (e) {
                const linkUrl = '/Pms/InfoProject?OID=' + e.args.row.bounddata.OID;
                if ($("div[tabUrl='" + linkUrl + "']").length > 0) {
                    var tabDiv = $("div[tabUrl='" + linkUrl + "']")[0].parentNode;
                    $('#tabContent').jqxTabs('select', $(tabDiv).index());
                    return;
                }

                const loading$ = $('#loading');
                const tabContent$ = $('#tabContent');
                loading$.css('display', 'block');
                var linkName = e.args.row.bounddata.Name;
                tabContent$.jqxTabs('addLast', linkName, "");
                var tabLength = tabContent$.jqxTabs('length');
                $.ajax({
                    url: linkUrl,
                    type: 'get',
                    dataType: 'html',
                    async: true,
                    success: function (resHtml) {
                        var content = tabContent$.jqxTabs('getContentAt', tabLength - 1);
                        $(content).html("<div class='wrapPage' tabUrl='" + linkUrl + "'>" + resHtml + "</div>");
                    }, error: function (res) {
                        if (res.status === 404) {
                            alert("현재 개발중인 화면입니다.");
                            return false;
                        }
                        alert(res.responseText);
                        console.log(res);
                    }
                    , complete: function () {
                        loading$.css('display', 'none');
                    }
                });
                selDashBoardDialog.close();
            });
        });
    </script>
</body>
</html>
