@{
    Layout = null;
}

<div style="padding:10px;">
    <table width="100%">
        <tbody>
            <tr>
                <td>
                    <h2><i class="fas fa-edit"></i> 문서 등록</h2>
                </td>
                <td style="text-align: right;">
                    <button id="CreateDocument_createbtn" class="custom-button"><i class="fas fa-plus-square"></i> 등록</button>
                    <button id="CreateDocument_canclebtn" class="custom-button"><i class="fas fa-window-close"></i> 취소</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div>
    <table class="createtable doc_create">
        <tr>
            <th class="reqVal"><i class="fa fa-caret-right"></i> 문서 분류</th>
            <td>
                <input type="hidden" id="CreateDocument_DocClassOID" autocomplete="off" />
                <input type="text" id="CreateDocument_DocClassName" autocomplete="off"  class="readonly _r" readonly="readonly" />
            </td>
            <td colspan="2">
            <button id="CreateDocument_selDocClass" class="custom-button"><i class="fas fa-plus-square"></i> 문서분류체계 선택</button></td>
        </tr>
        <tr>
            <th class="reqVal"><i class="fa fa-caret-right"></i> 제목</th>
            <td>
                <input type="text" id="CreateDocument_Title" autocomplete="off" />
            </td>
            <th><i class="fa fa-caret-right"></i> 작성자</th>
            <td><input type="text" id="CreateDocument_CreateUs" class="readonly _r" readonly="readonly" autocomplete="off" value="@Session["UserNm"]"></td>

        </tr>
        <tr>
            <th class="reqVal"><i class="fa fa-caret-right"></i> 문서번호</th>
            <td>
                <input type="text" id="CreateDocument_Name" autocomplete="off" class="readonly _r" readonly="readonly" value="자동 발번" />
            </td>
            <th><i class="fa fa-caret-right"></i> 작성일</th>
            <td><input type="text" id="CreateDocument_CreateDt" class="readonly" readonly="readonly" autocomplete="off" value="@Convert.ToString(DateTime.Now.ToString("yyyy-MM-dd"))" /></td>
        </tr>
        <tr>
            <th class="reqVal"><i class="fa fa-caret-right"></i> 리비전</th>
            <td>
                <input type="text" id="" autocomplete="off" class="readonly _r" readonly="readonly" value="00" />
            </td>
        </tr>
        <tr>
            <th style="vertical-align:top;"><i class="fa fa-caret-right"></i> 내용</th>
            <td colspan="3">
                <textarea id="CreateDocument_Description" autocomplete="off"></textarea>
            </td>
        </tr>
        <tr>
            <th style="vertical-align:top;"><i class="fa fa-caret-right"></i> 첨부파일</th>
            <td colspan="3">
                <div id="CreateDocument_Files" style="width:100%;">
                </div>
            </td>
        </tr>
    </table>
</div>
<script>
    var documentFile = $('#CreateDocument_Files').FileUpload({});
    var docClassName = $('#CreateDocument_DocClassName');
    var docClassOID = $('#CreateDocument_DocClassOID');
    $(function () {
        $('#CreateDocument_selDocClass').on('click', function () {
            var param = {};
            param.Type = '@Common.Constant.DocumentConstant.TYPE_DOCUMENT';
            OpenNewAddDocClassification(function (res) {
            }, null, param, '/Pms/dlgDocClassDeliveries', '문서 분류 검색 추가', null);
        });
        documentFile.EditMode();
        $('#CreateDocument_createbtn').on('click', function () {
            const param = {};
            param.Title = $('#CreateDocument_Title').val();                 //제목
            param.DocType = $('#CreateDocument_DocClassOID').val();  //문서분류
            //  param.Description = $('#CreateDocument_Description').val();     //설명
            param.Files = documentFile.Files();

            var removeFiles = documentFile.RemoveFiles();
            if (!WebUtils.isEmpty(removeFiles)) {
                param.delFiles = [];
                param.delFiles = removeFiles;
            }
            if (param.DocType == null || param.DocType.length < 1) {
                alert('분류체계를 선택해주세요.');
                return;
            }
            if (param.Title == null || param.Title.length < 1) {
                alert('제목을 입력해주세요.');
                return;
            }
            SendDataWithFile('/Document/InsertDocument', param, null, function (response) {
                if (response.isError) {
                    alert(response.resultMessage);
                    return;
                }
                var innerParam = {};
                innerParam.OID = response;
                innerParam.Title = $('#CreateDocument_Title').val();
                innerParam.Description = $('#CreateDocument_Description').val();     //설명
                RequestData('/Document/UdtDocument', innerParam, function (response) {
                    if (response.isError) {
                        alert(response.resultMessage);
                        return;
                    }
                    alert("저장되었습니다.");
                    PageReload();
                });
            });
        });
    });
</script>