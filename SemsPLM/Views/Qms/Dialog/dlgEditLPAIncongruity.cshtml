@{
    Layout = null;
}
<div style="padding:20px;">
    <table width="100%">
        <tbody>
            <tr>
                <td>
                    <h2><i class="fas fa-edit"></i> Error Proof장치점검 등록</h2>
                </td>
                <td style="text-align: right;">
                    <button id="btnDlgEditLPAIncongruitySave" class="custom-button"><i class="fas fa-plus-square"></i> 등록</button>
                    <button id="btnDlgEditLPAIncongruityCancel" class="custom-button"><i class="fas fa-window-close"></i> 취소</button>
                </td>
            </tr>
        </tbody>
    </table>
</div>
<div>
    <h3 class="qmsDlgH"><i class="fas fa-caret-square-down"></i> 기본정보</h3>
    <table width="100%" cellpadding="0" cellspacing="0" class="createtable">
        <colgroup>
            <col style="width:180px;" />
            <col style="width:auto;" />
            <col style="width:180px;" />
            <col style="width:auto;" />
        </colgroup>
        <tr>
            <th>Layer</th>
            <td>
                <div id="comboDlgEditLPAIncongruityLayerLib"></div>
            </td>
            <th>감사주기</th>
            <td>
                <div id="comboDlgEditLPAIncongruityAuditLib"></div>
            </td>
        </tr>
        <tr>
            <th>그룹군</th>
            <td>
                <div id="comboDlgEditLPAIncongruityLpaGrpLib"></div>
            </td>
            <th>사용구분</th>
            <td>
                <div id="comboDlgEditLPAIncongruityLpaUseLib"></div>
            </td>
        </tr>
        <tr>
            <th>심사자</th>
            <td>
                <div style="display:flex;">
                    <input type="text" id="txtDlgEditLPAIncongruityLpaCheckUser" style="width:120px;" readonly />
                    <button id="btnDlgEditLPAIncongruityLpaCheckUser" class="custom-button"><i class="fas fa-search"></i> 검색</button>
                </div>
            </td>
            <th>확인공정</th>
            <td>
                <div id="comboDlgEditLPAIncongruityLpaCheckProcessLib"></div>
            </td>
        </tr>
        <tr>
            <th>심사일자</th>
            <td>
                <div id="dtDlgEditLPAIncongruityLpaCheckDt"></div>
            </td>
            <th>설비명</th>
            <td>
                <input type="text" id="txtDlgEditLPAIncongruityEquipmentNm" style="width:100%;" />
            </td>
        </tr>
        <tr>
            <th>품번/품명</th>
            <td colspan="3">
                <div style="display:flex;">
                    <input type="text" id="txtDlgEditLPAIncongruityPartNm" style="width:120px;" readonly />
                    <input type="text" id="txtDlgEditLPAIncongruityPartCd" style="width:120px;" readonly />
                    <button id="btnDlgEditLPAIncongruityPart" class="custom-button"><i class="fas fa-search"></i> 검색</button>
                </div>
            </td>
        </tr>
        <tr>
            <th>지적사항</th>
            <td colspan="3">
                <textarea id="txtDlgEditLPAIncongruityCheckPoin"></textarea>
            </td>
        </tr>
        <tr>
            <th>담당자</th>
            <td colspan="3">
                <div style="display:flex;">
                    <input type="text" id="txtDlgEditLPAIncongruityLpaUser" style="width:120px;" readonly />
                    <button id="btnDlgEditLPAIncongruityLpaUser" class="custom-button"><i class="fas fa-search"></i> 검색</button>
                </div>
            </td>
        </tr>
        <tr>
            <th>완료예정일</th>
            <td>
                <div id="dtDlgEditLPAIncongruityEstDt"></div>
            </td>
            <th>처리일자</th>
            <td>
                <div id="dtDlgEditLPAIncongruityActDt"></div>
            </td>
        </tr>
        <tr>
            <th>신속대응 NO</th>
            <td colspan="3">
                <input type="text" id="txtDlgEditLPAIncongruityQuick" style="width:200px;" readonly />
            </td>
        </tr>
    </table>
</div>

<div style="margin-top:25px;">
    <h3 class="qmsDlgH"><i class="fas fa-caret-square-down"></i> 첨부문서파일</h3>
    <table width="100%" cellpadding="0" cellspacing="0" class="createtable">
        <colgroup>
            <col style="width:180px;" />
            <col style="width:auto;" />
        </colgroup>
        <tr>
            <th>
                <i class="fa fa-caret-right"></i>
                <button id="btnDlgEditLPAIncongruityFileSearch" class="custom-button"><i class="fas fa-plus-square"></i> 파일등록</button>
            </th>
            <td>
                <input type="text" id="txtDlgEditLPAIncongruityFile" style="width:100%" readonly/>
            </td>
        </tr>
    </table>
</div>

<div style="margin-top:25px;">
    <h3 class="qmsDlgH"><i class="fas fa-caret-square-down"></i> 대책서담당</h3>
    <table width="100%" cellpadding="0" cellspacing="0" class="createtable">
        <colgroup>
            <col style="width:180px;" />
            <col style="width:auto;" />
        </colgroup>
        <tr>
            <th>
                <i class="fa fa-caret-right"></i>
                <button id="btnDlgEditLPAIncongruityMeasureUser" class="custom-button"><i class="fas fa-plus-square"></i> 담당자지정</button>
            </th>
            <td>
                <input type="text" id="txtDlgEditLPAIncongruityMeasureUser" style="width:120px;" readonly />
            </td>
        </tr>
    </table>
</div>

<script>
    $(function () {

        // Combo Widget
        var comboLayerLib$ = $("#comboDlgEditLPAIncongruityLayerLib").jqxComboBox({ selectedIndex: 0, source: WebUtils.ConvComboData(@Html.Raw(Json.Encode(ViewBag.LayerLibList)), "OID", "KorNm", true), displayMember: "text", valueMember: "value", width: "100%", height: 30 });
        var comboAuditLib$ = $("#comboDlgEditLPAIncongruityAuditLib").jqxComboBox({ selectedIndex: 0, source: WebUtils.ConvComboData(@Html.Raw(Json.Encode(ViewBag.AuditLibList)), "OID", "KorNm", true), displayMember: "text", valueMember: "value", width: "100%", height: 30 });
        var comboLpaGrpLib$ = $("#comboDlgEditLPAIncongruityLpaGrpLib").jqxComboBox({ selectedIndex: 0, source: WebUtils.ConvComboData(@Html.Raw(Json.Encode(ViewBag.LpaGrpLibList)), "OID", "KorNm", true), displayMember: "text", valueMember: "value", width: "100%", height: 30 });
        var comboLpaUseLib$ = $("#comboDlgEditLPAIncongruityLpaUseLib").jqxComboBox({ selectedIndex: 0, source: WebUtils.ConvComboData(@Html.Raw(Json.Encode(ViewBag.LpaUseLibList)), "OID", "KorNm", true), displayMember: "text", valueMember: "value", width: "100%", height: 30 });
        var comboLpaCheckProcessLib$ = $("#comboDlgEditLPAIncongruityLpaCheckProcessLib").jqxComboBox({ selectedIndex: 0, source: WebUtils.ConvComboData(@Html.Raw(Json.Encode(ViewBag.LpaCheckProcessLibList)), "OID", "KorNm", true), displayMember: "text", valueMember: "value", width: "100%", height: 30 });

        // Date Widget
        var dtDlgEditLPAIncongruityLpaCheckDt$ = $("#dtDlgEditLPAIncongruityLpaCheckDt");
        var dtDlgEditLPAIncongruityEstDt$ = $("#dtDlgEditLPAIncongruityEstDt");
        var dtDlgEditLPAIncongruityActDt$ = $("#dtDlgEditLPAIncongruityActDt");

        // 심사일자
        dtDlgEditLPAIncongruityLpaCheckDt$.jqxDateTimeInput(DateFormat);
        dtDlgEditLPAIncongruityLpaCheckDt$.val(WebUtils.GetDate(-1, "m", "-"));
        dtDlgEditLPAIncongruityLpaCheckDt$.jqxDateTimeInput({ width: 150, height: 32 });

        // 완료예정일
        dtDlgEditLPAIncongruityEstDt$.jqxDateTimeInput(DateFormat);
        dtDlgEditLPAIncongruityEstDt$.val(WebUtils.GetDate(-1, "m", "-"));
        dtDlgEditLPAIncongruityEstDt$.jqxDateTimeInput({ width: 150, height: 32 });

        // 처리일자
        dtDlgEditLPAIncongruityActDt$.jqxDateTimeInput(DateFormat);
        dtDlgEditLPAIncongruityActDt$.val(WebUtils.GetDate(-1, "m", "-"));
        dtDlgEditLPAIncongruityActDt$.jqxDateTimeInput({ width: 150, height: 32 });

        // 심사자 검색
        var btnDlgUserLpaCheckUser$ = $("#btnDlgEditLPAIncongruityLpaCheckUser").jqxButton();
        btnDlgUserLpaCheckUser$.on("click", function () {
            OpenApprovalPersonDialog(function (res) {
                if (res.length > 1) {
                    alert("담당자는 한명만 지정 할 수 있습니다.");
                    return;
                }

                $("#txtDlgEditLPAIncongruityLpaCheckUser").val(res[0].Name);
                $("#txtDlgEditLPAIncongruityLpaCheckUser").attr("LpaCheckUserOID", res[0].OID);

            }, null, null, '/Common/ApprovalPerson', '사용자 검색');
        });

        // 담당자 검색
        var btnDlgUserSearch$ = $("#btnDlgEditLPAIncongruityLpaUser").jqxButton();
        btnDlgUserSearch$.on("click", function () {
            OpenApprovalPersonDialog(function (res) {
                if (res.length > 1) {
                    alert("담당자는 한명만 지정 할 수 있습니다.");
                    return;
                }

                $("#txtDlgEditLPAIncongruityLpaUser").val(res[0].Name);
                $("#txtDlgEditLPAIncongruityLpaUser").attr("LpaUserOID", res[0].OID);

            }, null, null, '/Common/ApprovalPerson', '사용자 검색');
        });

        // 대책서담당 검색
        var btnDlgUserMeasureSearch$ = $("#btnDlgEditLPAIncongruityMeasureUser").jqxButton();
        btnDlgUserMeasureSearch$.on("click", function () {
            OpenApprovalPersonDialog(function (res) {
                if (res.length > 1) {
                    alert("담당자는 한명만 지정 할 수 있습니다.");
                    return;
                }

                $("#txtDlgEditLPAIncongruityMeasureUser").val(res[0].Name);
                $("#txtDlgEditLPAIncongruityMeasureUser").attr("MeasureUserOID", res[0].OID);

            }, null, null, '/Common/ApprovalPerson', '사용자 검색');
        });

        // 파일등록
        var btnDlgFileSearch$ = $("#btnDlgEditLPAIncongruityFileSearch").jqxButton();
        btnDlgFileSearch$.on("click", function () {
            // 파일등록 로직 필요

            $("#txtDlgEditLPAIncongruityFile").val();
            $("#txtDlgEditLPAIncongruityFile").attr("FileNm");
        });

        var btnDlgPart$ = $("#btnDlgEditLPAIncongruityPart").jqxButton();
        btnDlgPart$.on("click", function () {
            $("#txtDlgEditLPAIncongruityPartNm").val("테스트");
            $("#txtDlgEditLPAIncongruityPartCd").val("PART-12345");
            $("#txtDlgEditLPAIncongruityPartCd").attr("PartOID", "12345");
        });

        // 저장
        var btnDlgSave$ = $("#btnDlgEditLPAIncongruitySave").jqxButton();
        btnDlgSave$.on("click", function () {
            var param = {};
            param.LpaUnfitCheck = {};

            param.OID = "@Model.OID";
            param.QuickOID = "@ViewBag.QuickOID";
            param.ModuleOID = "@ViewBag.ModuleOID";
            param.LayerLibOID = comboLayerLib$.jqxComboBox("getSelectedItem").value;
            param.AuditLibOID = comboAuditLib$.jqxComboBox("getSelectedItem").value;
            param.LpaGrpLibOID = comboLpaGrpLib$.jqxComboBox("getSelectedItem").value;
            param.LpaUseLibOID = comboLpaUseLib$.jqxComboBox("getSelectedItem").value;
            param.LpaCheckProcessLibOID = comboLpaCheckProcessLib$.jqxComboBox("getSelectedItem").value;
            param.LpaCheckUserOID = $("#txtDlgEditLPAIncongruityLpaCheckUser").attr("LpaCheckUserOID");
            param.LpaCheckDt = dtDlgEditLPAIncongruityLpaCheckDt$.val();
            param.EquipmentNm = $("#txtDlgEditLPAIncongruityEquipmentNm").val();
            param.PartOID = $("#txtDlgEditLPAIncongruityPartCd").attr("PartOID");
            param.LpaUserOID = $("#txtDlgEditLPAIncongruityLpaUser").attr("LpaUserOID");
            param.FinishRequestDt = dtDlgEditLPAIncongruityEstDt$.val();
            param.MeasureUserOID = $("#txtDlgEditLPAIncongruityMeasureUser").attr("MeasureUserOID");
            param.LpaUnfitCheck.CheckPoin = $("#txtDlgEditLPAIncongruityCheckPoin").val();

            if (param.LayerLibOID == undefined || param.LayerLibOID == null) {
                alert("레이어를 선택 해주세요.");
                return;
            }

            if (param.AuditLibOID == undefined || param.AuditLibOID == null) {
                alert("감사주기를 선택 해주세요.");
                return;
            }

            if (param.LpaGrpLibOID == undefined || param.LpaGrpLibOID == null) {
                alert("그룹군을 선택 해주세요.");
                return;
            }

            if (param.LpaUseLibOID == undefined || param.LpaUseLibOID == null) {
                alert("사용구분을 선택 해주세요.");
                return;
            }

            if (param.LpaCheckProcessLibOID == undefined || param.LpaCheckProcessLibOID == null) {
                alert("확인공정을 선택 해주세요.");
                return;
            }

            if (param.LpaUnfitCheck.CheckPoin == undefined || param.LpaUnfitCheck.CheckPoin == null) {
                alert("지적상황을 입력 해주세요");
                return;
            }

            $.post('/Qms/InsLPAIncongruity', param, function (response) {
                if (response.isError) {
                    alert(response.resultMessage);
                    return;
                }

                alert("저장되었습니다.");
                CloseDlgLPAIncongruity();
            }).fail(function (err) {
                alert(err.responseText);
            });
        });

        // 취소
        var btnDlgCancel$ = $("#btnDlgEditLPAIncongruityCancel").jqxButton();
        btnDlgCancel$.on("click", function () {
            CloseDlgLPAIncongruity();
        });
    });
</script>

