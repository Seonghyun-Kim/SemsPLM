function fPmsLoadProperties(e,t){const r=[];const n=fPmsArrayTasks(e);for(var a=0;a<n.length;a++){r.push(n[a][t])}return r}function fPmsArrayDataRecusive(e,t,r){var n=[];fArrayRecusive(e,n,[]);const a=[];for(var i in n){var o={};for(var f in t){if(r.indexOf(t[f]["name"])>-1){continue}o[t[f]["name"]]=n[i][t[f]["name"]]}a.push(o)}return a}function fPmsArrayTasks(e){var t=[];if(e!=null&&e.length>0){fArrayRecusive(e,t,["PROJECT","PROJECT_TEMP"])}return t}function fArrayRecusive(e,t,r){for(var n=0;n<e.length;n++){if(_.indexOf(r,e[n].ObjType)<0){t.push(e[n])}if(e[n].Children){fArrayRecusive(e[n].Children,t,r)}}}function fPmsParentArray(e){var t=[];if(e!=null&&e.length>0){fArrayParentRecusive(e,t)}return t}function fArrayParentRecusive(e,t){for(var r=0;r<e.length;r++){t.push(e[r]);if(e[r].parent){fArrayParentRecusive([e[r].parent],t)}}}function fMasterLink(e){var t=[];var r=e;for(var n=0;n<r.length;n++){if(r[n].Dependency!=null&&r[n].Dependency.length>0){var a=r[n].Dependency.split(":");var i=r.filter(function(e){return e.Id==a[0]});var o={};o.from=i[0];o.to=r[n];t.push(o)}}return t}function fComputeCriticalPath(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.earlyStart=-1;n.earlyFinish=-1;n.latestStart=-1;n.latestFinish=-1;n.criticalCost=-1;n.isCritical=false}var a=[];var i=e.concat();while(i.length>0){var o=false;for(var r=0;r<i.length;r++){var f=i[r];var s=v(f,t);if(d(a,s)){var l=0;for(var u=0;u<s.length;u++){var n=s[u];if(n.criticalCost>l){l=n.criticalCost}}f.criticalCost=l+f.EstDuration;a.push(f);i.splice(r,1);o=true}}if(!o){console.error("Cyclic dependency, algorithm stopped!");return false}}y(e);var c=h(e);g(c,t);m(e);return e;function d(e,t){for(var r=0;r<t.length;r++){if(e.indexOf(t[r])<0)return false}return true}function D(e,t){var r=[];var n=e;if(t){r=t.filter(function(e){return e.from==n})}return r}function v(e,t){var r=[];var n=D(e,t);for(var a=0;a<n.length;a++)r.push(n[a].to);return r}function y(e){var t=-1;for(var r=0;r<e.length;r++){var n=e[r];if(n.criticalCost>t)t=n.criticalCost}for(var r=0;r<e.length;r++){var n=e[r];n.latestStart=t-n.criticalCost;n.latestFinish=n.latestStart+n.EstDuration}}function h(e){var t=[];for(var r=0;r<e.length;r++){if(!e[r].Dependency||e[r].Dependency=="")t.push(e[r])}return t}function g(e,t){for(var r=0;r<e.length;r++){var n=e[r];n.earlyStart=0;n.earlyFinish=n.EstDuration;p(n,t)}}function p(e,t){var r=e.earlyFinish;var n=v(e,t);for(var a=0;a<n.length;a++){var i=n[a];if(r>=i.earlyStart){i.earlyStart=r;i.earlyFinish=r+parseInt(i.EstDuration)}p(i,t)}}function m(e){for(var t=0;t<e.length;t++){var r=e[t];r.isCritical=r.earlyStart==r.latestStart}}}function fMoveRecusive(e,t,r){fMoveChildrenRecusive(e,t,r)}function fMoveChildrenRecusive(e,t,r){for(var n=0;n<e.length;n++){if(e[n].ToOID==t){if(r=="UP"){if(n-1<0){return}const a=e[n-1];e[n-1]=e[n];e[n]=a;return}else if(r=="DOWN"){if(n+1>=e.length){return}const a=e[n+1];e[n+1]=e[n];e[n]=a;return}else if(r=="LEFT"){const i=e[n];const o=e[n].parent.parent;const f=e[n].parent;if(o==undefined||f==undefined){return}if(o.Children.filter(function(e){return e.ToOID==parseInt(t)}).length>0){return}const s=f.Children.findIndex(function(e){return e.RelOID==i.RelOID});f.Children.splice(s,1);i.Level=i.Level-1;i.FromOID=o.ToOID;o.Children.push(i);return}else if(r=="RIGHT"){return}}if(e[n].Children){fMoveChildrenRecusive(e[n].Children,t,r)}}}function fPmsModifyValueRecusive(e,t,r){if(t!=undefined&&t.length>0){for(var n=0;n<t.length;n++){var a=e.jqxTreeGrid("getKey",t[n]);e.jqxTreeGrid("setCellValue",a,"EstStartDt",r);fPmsModifyValueRecusive(e,t[n].records,r)}}}function fWeekendCalcDuration(e,t,r,n){var a=new Date(e);var i=gDeaultWorkDay;var o=a;if(t<1){t=1}while(true){if(i==t){break}else{o.setDate(o.getDate()+1);var f=o.getDay();if(fPmsWokingDay(r,f)||n.indexOf("#"+moment(o).format("YYYY-MM-DD")+"#")>-1){}else{i++}}}return o}function fPmsWokingDay(e,t){var r=false;if(e==6){if(t==0){r=true}}else if(e==5){if(t==0||t==6){r=true}}return r}function fPmsModifyValueReverseRecusive(e,t,r){if(t!=undefined){var n=t.ToOID;if(new Date(t.EstEndDt).getTime()<new Date(r).getTime()){e.jqxTreeGrid("setCellValue",n,"EstEndDt",r);e.jqxTreeGrid("setCellValue",n,"EstDuration",fWeekendCalc(t.EstStartDt,r,t.WorkingDay,gPmsModifyHistoryHoliday[t.RootOID]))}else{const a=fPmsArrayTasks(t.Children);if(a!=null&&a.length>0){const i=moment(fMaxDate(fPmsLoadProperties(a,"EstEndDt"))).format("YYYY-MM-DD");e.jqxTreeGrid("setCellValue",n,"EstEndDt",i);e.jqxTreeGrid("setCellValue",n,"EstDuration",fWeekendCalc(t.EstStartDt,i,t.WorkingDay,gPmsModifyHistoryHoliday[t.RootOID]))}}if(t.parent!=null&&t.parent!=undefined){fPmsModifyValueReverseRecusive(e,t.parent,r)}}}function fWeekendCalc(e,t,r,n){var a=new Date(e);var i;if(typeof t=="string"){i=moment(t).toDate()}else{i=new Date(t)}var o=gDeaultWorkDay;var f=a;while(true){if(f.getTime()>=i.getTime()){break}else{f.setDate(f.getDate()+1);var s=f.getDay();if(fPmsWokingDay(r,s)||n.indexOf("#"+moment(f).format("YYYY-MM-DD")+"#")>-1){}else{o++}}}return o}function fMaxDate(e){var r=e[0],n=new Date(e[0]);e.forEach(function(e,t){if(new Date(e)>n){r=e;n=new Date(e)}});return r}function fMinDate(e){var r=e[0],n=new Date(e[0]);e.forEach(function(e,t){if(new Date(e)<n){r=e;n=new Date(e)}});return r}function fDependencyRescureControl(e,t){const r=gPmsModifyHistoryMaster[e].obj;const n=fPmsArrayTasks(r.jqxTreeGrid("getRows"));const a=fListMatch(n,function(e){return fGettingDependData(t.Dependency).hasOwnProperty(e.Id)});if(a.length>0){for(var i=0;i<a.length;i++){r.jqxTreeGrid("setCellValue",t.ToOID,"EstStartDt",fWeekendCalcDuration(a[i].EstEndDt,1+fGettingDependData(t.Dependency)[a[i].Id],t.WorkingDay,gPmsModifyHistoryHoliday[e]))}}fDependencyRescureDataControl(r,e,t,n)}function fDependencyRescureDataControl(e,t,r,n){const a=fListMatch(n,function(e){return e.Dependency!=null&&fGettingDependData(e.Dependency).hasOwnProperty(r.Id)});if(a.length>0){for(var i=0;i<a.length;i++){e.jqxTreeGrid("setCellValue",a[i].ToOID,"EstStartDt",fWeekendCalcDuration(r.EstEndDt,1+fGettingDependData(a[i].Dependency)[r.Id],r.WorkingDay,gPmsModifyHistoryHoliday[t]));fDependencyRescureDataControl(e,t,a[i],n)}}}function fDependencyRecureTargetDataControl(e,t,r,n){const a=fListMatch(n,function(e){return fGettingDependData(r.Dependency).hasOwnProperty(e.Id)});if(a.length>0){for(var i=0;i<a.length;i++){e.jqxTreeGrid("setCellValue",r.ToOID,"EstStartDt",fWeekendCalcDuration(a[i].EstEndDt,1+fGettingDependData(r.Dependency)[a[i].Id],r.WorkingDay,gPmsModifyHistoryHoliday[t]));fDependencyRecureTargetDataControl(e,t,a[i],n)}}}function fDependencyControl(e){const t=gPmsModifyHistoryMaster[e].obj;const r=fPmsArrayTasks(t.jqxTreeGrid("getRows"));for(var n=0;n<r.length;n++){fDependencyDataControl(t,e,n,r)}for(var n=r.length-1;n>=0;--n){fDependencyDataControl(t,e,n,r)}}function fDependencyDataControl(e,t,r,n){if(n[r].Dependency!=null&&n[r].Dependency.length>0){const i=n[r].Dependency;if(i.length>0){const o=i.split(":");var a=0;if(o.length>1){a=parseInt(o[1])-1}const f=fListMatch(n,function(e){return e.Id==o[0]});if(f.length>0){e.jqxTreeGrid("setCellValue",n[r].ToOID,"EstStartDt",fWeekendCalcDuration(f[0].EstEndDt,2+a,n[r].WorkingDay,gPmsModifyHistoryHoliday[t]))}}}}function fListMatch(e,t){var r=[];for(var n=0;n<e.length;n++){if(t(e[n])){r.push(e[n])}}return r}function fAddModMemberRecusive(e,t,r){fAddModMemberChildrenRecusive(e,t,r)}function fAddModMemberChildrenRecusive(e,t,r){for(var n=0;n<e.length;n++){if(e[n].ToOID==t){e[n].Members=[];for(var a=0;a<r.length;a++){e[n].Members.push(r[a])}return}if(e[n].Children){fAddModMemberChildrenRecusive(e[n].Children,t,r)}}}function fTaskStart(e,t,r){RequestData("Common/PromoteObjectTask",{Type:e.getAttribute("data-Type"),Status:e.getAttribute("data-Status"),OID:r,RootOID:t},function(){alert("타스크가 진행되었습니다.");gPmsModifyHistoryMaster[t].obj.jqxTreeGrid("pagerRenderer")})}function fInTaskStart(e,t,r){RequestData("Common/PromoteObjectTask",{Type:e.getAttribute("data-Type"),Status:e.getAttribute("data-Status"),OID:r,RootOID:t},function(){alert("타스크가 진행되었습니다.");gPmsModifyHistoryMaster[r].obj.jqxTreeGrid("pagerRenderer")})}function fGettingDependData(e){var t={};if(e!=null&&e!=undefined){var r=[];if(e.indexOf(",")>-1){r=e.split(",")}else{r.push(e)}for(var n=0,a=r.length;n<a;n++){if(r[n].indexOf(":")>-1){var i=r[n].split(":");t[i[0]]=parseInt(i[1]!=""?i[1]:"1")}else{if(r[n]!=""){t[r[n]]=1}}}}return t}